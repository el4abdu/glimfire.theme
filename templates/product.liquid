{%- assign current_variant = product.selected_or_first_available_variant -%}

<div class="product-container">
  <div class="product-gallery">
    <div class="main-image">
      <img src="{{ product.featured_image | img_url: '800x' }}" alt="{{ product.title }}" id="main-product-image">
    </div>
    
    {% if product.images.size > 1 %}
      <div class="thumbnail-grid">
        {% for image in product.images %}
          <div class="thumbnail" onclick="updateMainImage('{{ image | img_url: '800x' }}')">
            <img src="{{ image | img_url: '150x' }}" alt="{{ product.title }} - Image {{ forloop.index }}">
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="product-details">
    <h1>{{ product.title }}</h1>
    <div class="price">{{ current_variant.price | money }}</div>
    
    {% if product.description != blank %}
      <div class="description">
        {{ product.description }}
      </div>
    {% endif %}

    <form action="/cart/add" method="post" class="product-form">
      <input type="hidden" name="id" value="{{ current_variant.id }}">
      
      {% if product.variants.size > 1 %}
        <div class="variant-selector">
          <label for="variant-select">Select Option</label>
          <select name="id" id="variant-select">
            {% for variant in product.variants %}
              <option value="{{ variant.id }}" {% if variant == current_variant %}selected{% endif %}>
                {{ variant.title }}
              </option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      <div class="quantity-selector">
        <label for="quantity">Quantity</label>
        <div class="quantity-wrapper">
          <button type="button" onclick="updateQuantity(-1)">-</button>
          <input type="number" id="quantity" name="quantity" value="1" min="1">
          <button type="button" onclick="updateQuantity(1)">+</button>
        </div>
      </div>

      <button type="submit" class="add-to-cart">Add to Cart</button>
    </form>

    <div class="product-features">
      <h3>Product Features</h3>
      <ul>
        {% for tag in product.tags %}
          <li>{{ tag }}</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>

<style>
  .product-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .product-gallery {
    position: sticky;
    top: 2rem;
  }

  .main-image {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 1rem;
    background: rgba(45, 27, 48, 0.3);
  }

  .main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .thumbnail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
    gap: 1rem;
  }

  .thumbnail {
    aspect-ratio: 1;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    background: rgba(45, 27, 48, 0.3);
    transition: transform 0.3s ease;
  }

  .thumbnail:hover {
    transform: scale(1.05);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-details {
    color: var(--text-color);
  }

  .product-details h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .price {
    font-size: 1.5rem;
    color: var(--accent-color);
    margin-bottom: 1.5rem;
  }

  .description {
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .variant-selector,
  .quantity-selector {
    margin-bottom: 1.5rem;
  }

  .variant-selector label,
  .quantity-selector label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--accent-color);
  }

  select,
  .quantity-wrapper input {
    width: 100%;
    padding: 0.8rem;
    background: rgba(45, 27, 48, 0.3);
    border: 1px solid var(--accent-color);
    border-radius: 8px;
    color: var(--text-color);
  }

  .quantity-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .quantity-wrapper button {
    padding: 0.5rem 1rem;
    background: var(--accent-color);
    border: none;
    border-radius: 8px;
    color: var(--primary-color);
    cursor: pointer;
  }

  .quantity-wrapper input {
    width: 80px;
    text-align: center;
  }

  .add-to-cart {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    border: none;
    border-radius: 30px;
    color: var(--primary-color);
    font-weight: bold;
    font-size: 1.1rem;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .add-to-cart:hover {
    transform: scale(1.02);
  }

  .product-features {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .product-features h3 {
    color: var(--accent-color);
    margin-bottom: 1rem;
  }

  .product-features ul {
    list-style: none;
    padding: 0;
  }

  .product-features li {
    margin-bottom: 0.5rem;
    padding-left: 1.5rem;
    position: relative;
  }

  .product-features li:before {
    content: "â€¢";
    color: var(--accent-color);
    position: absolute;
    left: 0;
  }

  @media (max-width: 768px) {
    .product-container {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .product-gallery {
      position: static;
    }
  }
</style>

<script>
  function updateMainImage(url) {
    document.getElementById('main-product-image').src = url;
  }

  function updateQuantity(change) {
    const input = document.getElementById('quantity');
    const newValue = Math.max(1, parseInt(input.value) + change);
    input.value = newValue;
  }
</script> 